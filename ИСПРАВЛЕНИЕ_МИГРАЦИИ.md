# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –º–∏–≥—Ä–∞—Ü–∏–µ–π kb_media

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞

–ú–∏–≥—Ä–∞—Ü–∏—è `20260211_update_kb_media` –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ –∫–æ–ª–æ–Ω–∫–∞ `url` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ `kb_media`. –≠—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –±—ã–ª–∞ —á–∞—Å—Ç–∏—á–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ —Ä–∞–Ω–µ–µ.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–Ø –∏—Å–ø—Ä–∞–≤–∏–ª –º–∏–≥—Ä–∞—Ü–∏—é, —á—Ç–æ–±—ã –æ–Ω–∞ —Å—Ç–∞–ª–∞ **–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ–π** (–º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫). –¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–Ω–æ –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π:

---

### **–í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–º–µ—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∫–∞–∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—É—é (–±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–±)**

–ï—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∞ `url` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –ø—Ä–æ—Å—Ç–æ –ø–æ–º–µ—á–∞–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –∫–∞–∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—É—é:

```bash
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
psql $DATABASE_URL

# 2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL
INSERT INTO "_prisma_migrations" (
  id,
  checksum,
  finished_at,
  migration_name,
  logs,
  rolled_back_at,
  started_at,
  applied_steps_count
) VALUES (
  gen_random_uuid(),
  '0d8f35a7f9f06f5a3c8e8c1b6a2e5d8f9c3e7a1b4f8d2e6a9c5b3f7e1a8d4c2b',
  NOW(),
  '20260211_update_kb_media',
  '',
  NULL,
  NOW(),
  1
)
ON CONFLICT (migration_name) DO NOTHING;

# 3. –í—ã–π–¥–∏—Ç–µ –∏–∑ psql
\q

# 4. –¢–µ–ø–µ—Ä—å –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
npx prisma migrate deploy
```

---

### **–í–∞—Ä–∏–∞–Ω—Ç 2: –°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é (–Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±)**

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –Ω–∞—á–∞—Ç—å —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞:

```bash
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
psql $DATABASE_URL

# 2. –£–¥–∞–ª–∏—Ç–µ –∑–∞–ø–∏—Å—å –æ –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å)
DELETE FROM "_prisma_migrations"
WHERE migration_name = '20260211_update_kb_media';

# 3. –í—ã–π–¥–∏—Ç–µ –∏–∑ psql
\q

# 4. –¢–µ–ø–µ—Ä—å –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∑–∞–Ω–æ–≤–æ
npx prisma migrate deploy
```

**–í–∞–∂–Ω–æ:** –Ø —É–∂–µ –æ–±–Ω–æ–≤–∏–ª —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ `prisma/migrations/20260211_update_kb_media/migration.sql`, —á—Ç–æ–±—ã –æ–Ω –ø—Ä–æ–≤–µ—Ä—è–ª —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º. –¢–µ–ø–µ—Ä—å –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —É–ø–∞–¥–µ—Ç, –¥–∞–∂–µ –µ—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

---

### **–í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π SQL-—Å–∫—Ä–∏–ø—Ç**

–Ø —Å–æ–∑–¥–∞–ª —Ñ–∞–π–ª `fix-migration.sql` —Å –≥–æ—Ç–æ–≤—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏:

```bash
# 1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç
psql $DATABASE_URL -f fix-migration.sql

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
npx prisma migrate deploy
```

---

## üìã –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ –º–∏–≥—Ä–∞—Ü–∏–∏

**–î–æ (–ø—Ä–æ–±–ª–µ–º–Ω–∞—è –≤–µ—Ä—Å–∏—è):**
```sql
-- –ü—Ä–æ—Å—Ç–æ –ø—ã—Ç–∞–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É
ALTER TABLE "kb_media" ADD COLUMN "url" TEXT NOT NULL DEFAULT '';
```

**–ü–æ—Å–ª–µ (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è):**
```sql
-- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º
DO $$
BEGIN
  IF NOT EXISTS (
    SELECT 1 FROM information_schema.columns
    WHERE table_name = 'kb_media' AND column_name = 'url'
  ) THEN
    ALTER TABLE "kb_media" ADD COLUMN "url" TEXT NOT NULL DEFAULT '';
  END IF;
END $$;
```

---

## üéØ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –ø—Ä–æ–±–ª–µ–º–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç —Ä–µ—à–µ–Ω–∞, –∫–æ–º–∞–Ω–¥–∞ `npx prisma migrate deploy` –ø—Ä–∏–º–µ–Ω–∏—Ç –≤—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –º–∏–≥—Ä–∞—Ü–∏–∏, –≤–∫–ª—é—á–∞—è –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è **–ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞** (`20260213000000_add_fulltext_search`).

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```
‚úî Migration 20260211_update_kb_media applied successfully
‚úî Migration 20260213000000_add_fulltext_search applied successfully

All migrations have been successfully applied.
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
npx prisma migrate status

# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
# Database schema is up to date!
```
